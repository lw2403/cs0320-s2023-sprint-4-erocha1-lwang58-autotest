package edu.brown.cs32.weather.handlers;

import edu.brown.cs32.shared.APIFailureException;
import edu.brown.cs32.shared.ResultType;
import java.net.URL;
import java.util.Objects;
import org.json.JSONException;
import org.json.JSONObject;

/**
 * MockWeatherFinder used for testing with mocking Access hard-coded examples instead of calling NWS
 * API
 */
public class MockWeatherFinder implements Finder {
  // to count number of times findWeather is called
  private int callCount;

  public MockWeatherFinder() {}

  public MockWeatherFinder(int callCount) {
    this.callCount = callCount;
  }

  /**
   * returns hard-coded example based on input url
   *
   * @param url NWS API URL
   * @return hard-coded json object
   * @throws JSONException pass on to findWeather
   * @throws APIFailureException pass on to findWeather
   */
  @Override
  public JSONObject getJsonFromUrl(URL url) throws JSONException, APIFailureException {
    ++callCount;
    System.out.println(url.toString());
    String urlStr = url.toString();
    if (Objects.equals(urlStr, "https://api.weather.gov/points/-1000,1000")) {
      throw new APIFailureException(
          ResultType.error_bad_request, "incorrect coordinate parameters.");
    } else if (urlStr.startsWith("https://api.weather.gov/points/")) {
      return new JSONObject(
          "{\"geometry\":{\"coordinates\":[-78,35],\"type\":\"Point\"},\"id\":\"https://api.weather.gov/points/35,-78\",\"type\":\"Feature\",\"@context\":[\"https://geojson.org/geojson-ld/geojson-context.jsonld\",{\"wx\":\"https://api.weather.gov/ontology#\",\"@vocab\":\"https://api.weather.gov/ontology#\",\"distance\":{\"@type\":\"s:QuantitativeValue\",\"@id\":\"s:Distance\"},\"city\":\"s:addressLocality\",\"bearing\":{\"@type\":\"s:QuantitativeValue\"},\"county\":{\"@type\":\"@id\"},\"geo\":\"http://www.opengis.net/ont/geosparql#\",\"unit\":\"http://codes.wmo.int/common/unit/\",\"forecastGridData\":{\"@type\":\"@id\"},\"s\":\"https://schema.org/\",\"publicZone\":{\"@type\":\"@id\"},\"unitCode\":{\"@type\":\"@id\",\"@id\":\"s:unitCode\"},\"@version\":\"1.1\",\"forecastOffice\":{\"@type\":\"@id\"},\"geometry\":{\"@type\":\"geo:wktLiteral\",\"@id\":\"s:GeoCoordinates\"},\"state\":\"s:addressRegion\",\"value\":{\"@id\":\"s:value\"}}],\"properties\":{\"radarStation\":\"KRAX\",\"fireWeatherZone\":\"https://api.weather.gov/zones/fire/NCZ090\",\"@type\":\"wx:Point\",\"forecastZone\":\"https://api.weather.gov/zones/forecast/NCZ090\",\"county\":\"https://api.weather.gov/zones/county/NCC061\",\"timeZone\":\"America/New_York\",\"forecast\":\"https://api.weather.gov/gridpoints/MHX/10,32/forecast\",\"cwa\":\"MHX\",\"relativeLocation\":{\"geometry\":{\"coordinates\":[-77.966108,34.959652],\"type\":\"Point\"},\"type\":\"Feature\",\"properties\":{\"distance\":{\"unitCode\":\"wmoUnit:m\",\"value\":5446.4126128462},\"city\":\"Kenansville\",\"bearing\":{\"unitCode\":\"wmoUnit:degree_(angle)\",\"value\":325},\"state\":\"NC\"}},\"forecastHourly\":\"https://api.weather.gov/gridpoints/MHX/10,32/forecast/hourly\",\"observationStations\":\"https://api.weather.gov/gridpoints/MHX/10,32/stations\",\"gridX\":10,\"forecastGridData\":\"https://api.weather.gov/gridpoints/MHX/10,32\",\"gridY\":32,\"forecastOffice\":\"https://api.weather.gov/offices/MHX\",\"@id\":\"https://api.weather.gov/points/35,-78\",\"gridId\":\"MHX\"}}");
    } else if (urlStr.startsWith("https://api.weather.gov/gridpoints/")
        && urlStr.endsWith("/forecast")) {
      return new JSONObject(
          "{\"geometry\":{\"coordinates\":[[[-78.0054046,35.0171072],[-78.00883660000001,34.9947966],[-77.98160720000001,34.991984],[-77.97816970000001,35.0142941],[-78.0054046,35.0171072]]],\"type\":\"Polygon\"},\"type\":\"Feature\",\"@context\":[\"https://geojson.org/geojson-ld/geojson-context.jsonld\",{\"geo\":\"http://www.opengis.net/ont/geosparql#\",\"wx\":\"https://api.weather.gov/ontology#\",\"unit\":\"http://codes.wmo.int/common/unit/\",\"@vocab\":\"https://api.weather.gov/ontology#\",\"@version\":\"1.1\"}],\"properties\":{\"elevation\":{\"unitCode\":\"wmoUnit:m\",\"value\":35.9664},\"validTimes\":\"2023-03-03T07:00:00+00:00/P7DT18H\",\"forecastGenerator\":\"BaselineForecastGenerator\",\"generatedAt\":\"2023-03-03T14:09:17+00:00\",\"periods\":[{\"detailedForecast\":\"A slight chance of rain showers before 3pm. Mostly cloudy, with a high near 74. Southeast wind 9 to 16 mph, with gusts as high as 29 mph. Chance of precipitation is 20%. New rainfall amounts less than a tenth of an inch possible.\",\"dewpoint\":{\"unitCode\":\"wmoUnit:degC\",\"value\":15.555555555555555},\"temperatureTrend\":null,\"shortForecast\":\"Slight Chance Rain Showers\",\"icon\":\"https://api.weather.gov/icons/land/day/rain_showers,20?size=medium\",\"number\":1,\"temperatureUnit\":\"F\",\"probabilityOfPrecipitation\":{\"unitCode\":\"wmoUnit:percent\",\"value\":20},\"name\":\"Today\",\"temperature\":74,\"relativeHumidity\":{\"unitCode\":\"wmoUnit:percent\",\"value\":87},\"startTime\":\"2023-03-03T09:00:00-05:00\",\"isDaytime\":true,\"endTime\":\"2023-03-03T18:00:00-05:00\",\"windDirection\":\"SE\",\"windSpeed\":\"9 to 16 mph\"},{\"detailedForecast\":\"A chance of rain showers between 10pm and 3am. Partly cloudy, with a low around 60. Southwest wind 17 to 24 mph, with gusts as high as 40 mph. Chance of precipitation is 30%. New rainfall amounts less than a tenth of an inch possible.\",\"dewpoint\":{\"unitCode\":\"wmoUnit:degC\",\"value\":17.22222222222222},\"temperatureTrend\":null,\"shortForecast\":\"Chance Rain Showers\",\"icon\":\"https://api.weather.gov/icons/land/night/rain_showers,20/rain_showers,30?size=medium\",\"number\":2,\"temperatureUnit\":\"F\",\"probabilityOfPrecipitation\":{\"unitCode\":\"wmoUnit:percent\",\"value\":30},\"name\":\"Tonight\",\"temperature\":60,\"relativeHumidity\":{\"unitCode\":\"wmoUnit:percent\",\"value\":84},\"startTime\":\"2023-03-03T18:00:00-05:00\",\"isDaytime\":false,\"endTime\":\"2023-03-04T06:00:00-05:00\",\"windDirection\":\"SW\",\"windSpeed\":\"17 to 24 mph\"},{\"detailedForecast\":\"Sunny. High near 73, with temperatures falling to around 66 in the afternoon. West wind 12 to 17 mph, with gusts as high as 28 mph.\",\"dewpoint\":{\"unitCode\":\"wmoUnit:degC\",\"value\":11.11111111111111},\"temperatureTrend\":\"falling\",\"shortForecast\":\"Sunny\",\"icon\":\"https://api.weather.gov/icons/land/day/skc?size=medium\",\"number\":3,\"temperatureUnit\":\"F\",\"probabilityOfPrecipitation\":{\"unitCode\":\"wmoUnit:percent\",\"value\":null},\"name\":\"Saturday\",\"temperature\":73,\"relativeHumidity\":{\"unitCode\":\"wmoUnit:percent\",\"value\":72},\"startTime\":\"2023-03-04T06:00:00-05:00\",\"isDaytime\":true,\"endTime\":\"2023-03-04T18:00:00-05:00\",\"windDirection\":\"W\",\"windSpeed\":\"12 to 17 mph\"},{\"detailedForecast\":\"Clear, with a low around 41. North wind 6 to 9 mph.\",\"dewpoint\":{\"unitCode\":\"wmoUnit:degC\",\"value\":5},\"temperatureTrend\":null,\"shortForecast\":\"Clear\",\"icon\":\"https://api.weather.gov/icons/land/night/skc?size=medium\",\"number\":4,\"temperatureUnit\":\"F\",\"probabilityOfPrecipitation\":{\"unitCode\":\"wmoUnit:percent\",\"value\":null},\"name\":\"Saturday Night\",\"temperature\":41,\"relativeHumidity\":{\"unitCode\":\"wmoUnit:percent\",\"value\":76},\"startTime\":\"2023-03-04T18:00:00-05:00\",\"isDaytime\":false,\"endTime\":\"2023-03-05T06:00:00-05:00\",\"windDirection\":\"N\",\"windSpeed\":\"6 to 9 mph\"},{\"detailedForecast\":\"Sunny, with a high near 66. Northeast wind 3 to 8 mph.\",\"dewpoint\":{\"unitCode\":\"wmoUnit:degC\",\"value\":3.3333333333333335},\"temperatureTrend\":null,\"shortForecast\":\"Sunny\",\"icon\":\"https://api.weather.gov/icons/land/day/skc?size=medium\",\"number\":5,\"temperatureUnit\":\"F\",\"probabilityOfPrecipitation\":{\"unitCode\":\"wmoUnit:percent\",\"value\":null},\"name\":\"Sunday\",\"temperature\":66,\"relativeHumidity\":{\"unitCode\":\"wmoUnit:percent\",\"value\":79},\"startTime\":\"2023-03-05T06:00:00-05:00\",\"isDaytime\":true,\"endTime\":\"2023-03-05T18:00:00-05:00\",\"windDirection\":\"NE\",\"windSpeed\":\"3 to 8 mph\"},{\"detailedForecast\":\"Clear, with a low around 39.\",\"dewpoint\":{\"unitCode\":\"wmoUnit:degC\",\"value\":4.444444444444445},\"temperatureTrend\":null,\"shortForecast\":\"Clear\",\"icon\":\"https://api.weather.gov/icons/land/night/skc?size=medium\",\"number\":6,\"temperatureUnit\":\"F\",\"probabilityOfPrecipitation\":{\"unitCode\":\"wmoUnit:percent\",\"value\":null},\"name\":\"Sunday Night\",\"temperature\":39,\"relativeHumidity\":{\"unitCode\":\"wmoUnit:percent\",\"value\":100},\"startTime\":\"2023-03-05T18:00:00-05:00\",\"isDaytime\":false,\"endTime\":\"2023-03-06T06:00:00-05:00\",\"windDirection\":\"SE\",\"windSpeed\":\"3 mph\"},{\"detailedForecast\":\"Sunny, with a high near 73.\",\"dewpoint\":{\"unitCode\":\"wmoUnit:degC\",\"value\":7.222222222222222},\"temperatureTrend\":null,\"shortForecast\":\"Sunny\",\"icon\":\"https://api.weather.gov/icons/land/day/few?size=medium\",\"number\":7,\"temperatureUnit\":\"F\",\"probabilityOfPrecipitation\":{\"unitCode\":\"wmoUnit:percent\",\"value\":null},\"name\":\"Monday\",\"temperature\":73,\"relativeHumidity\":{\"unitCode\":\"wmoUnit:percent\",\"value\":100},\"startTime\":\"2023-03-06T06:00:00-05:00\",\"isDaytime\":true,\"endTime\":\"2023-03-06T18:00:00-05:00\",\"windDirection\":\"S\",\"windSpeed\":\"2 to 7 mph\"},{\"detailedForecast\":\"Partly cloudy, with a low around 54.\",\"dewpoint\":{\"unitCode\":\"wmoUnit:degC\",\"value\":12.222222222222221},\"temperatureTrend\":null,\"shortForecast\":\"Partly Cloudy\",\"icon\":\"https://api.weather.gov/icons/land/night/sct?size=medium\",\"number\":8,\"temperatureUnit\":\"F\",\"probabilityOfPrecipitation\":{\"unitCode\":\"wmoUnit:percent\",\"value\":null},\"name\":\"Monday Night\",\"temperature\":54,\"relativeHumidity\":{\"unitCode\":\"wmoUnit:percent\",\"value\":96},\"startTime\":\"2023-03-06T18:00:00-05:00\",\"isDaytime\":false,\"endTime\":\"2023-03-07T06:00:00-05:00\",\"windDirection\":\"SW\",\"windSpeed\":\"7 to 10 mph\"},{\"detailedForecast\":\"Partly sunny, with a high near 78.\",\"dewpoint\":{\"unitCode\":\"wmoUnit:degC\",\"value\":15},\"temperatureTrend\":null,\"shortForecast\":\"Partly Sunny\",\"icon\":\"https://api.weather.gov/icons/land/day/bkn?size=medium\",\"number\":9,\"temperatureUnit\":\"F\",\"probabilityOfPrecipitation\":{\"unitCode\":\"wmoUnit:percent\",\"value\":null},\"name\":\"Tuesday\",\"temperature\":78,\"relativeHumidity\":{\"unitCode\":\"wmoUnit:percent\",\"value\":96},\"startTime\":\"2023-03-07T06:00:00-05:00\",\"isDaytime\":true,\"endTime\":\"2023-03-07T18:00:00-05:00\",\"windDirection\":\"W\",\"windSpeed\":\"8 to 13 mph\"},{\"detailedForecast\":\"Partly cloudy, with a low around 46.\",\"dewpoint\":{\"unitCode\":\"wmoUnit:degC\",\"value\":11.666666666666666},\"temperatureTrend\":null,\"shortForecast\":\"Partly Cloudy\",\"icon\":\"https://api.weather.gov/icons/land/night/sct?size=medium\",\"number\":10,\"temperatureUnit\":\"F\",\"probabilityOfPrecipitation\":{\"unitCode\":\"wmoUnit:percent\",\"value\":null},\"name\":\"Tuesday Night\",\"temperature\":46,\"relativeHumidity\":{\"unitCode\":\"wmoUnit:percent\",\"value\":65},\"startTime\":\"2023-03-07T18:00:00-05:00\",\"isDaytime\":false,\"endTime\":\"2023-03-08T06:00:00-05:00\",\"windDirection\":\"NW\",\"windSpeed\":\"9 mph\"},{\"detailedForecast\":\"Mostly sunny, with a high near 60.\",\"dewpoint\":{\"unitCode\":\"wmoUnit:degC\",\"value\":1.6666666666666667},\"temperatureTrend\":null,\"shortForecast\":\"Mostly Sunny\",\"icon\":\"https://api.weather.gov/icons/land/day/sct?size=medium\",\"number\":11,\"temperatureUnit\":\"F\",\"probabilityOfPrecipitation\":{\"unitCode\":\"wmoUnit:percent\",\"value\":null},\"name\":\"Wednesday\",\"temperature\":60,\"relativeHumidity\":{\"unitCode\":\"wmoUnit:percent\",\"value\":63},\"startTime\":\"2023-03-08T06:00:00-05:00\",\"isDaytime\":true,\"endTime\":\"2023-03-08T18:00:00-05:00\",\"windDirection\":\"N\",\"windSpeed\":\"9 mph\"},{\"detailedForecast\":\"Partly cloudy, with a low around 42.\",\"dewpoint\":{\"unitCode\":\"wmoUnit:degC\",\"value\":2.2222222222222223},\"temperatureTrend\":null,\"shortForecast\":\"Partly Cloudy\",\"icon\":\"https://api.weather.gov/icons/land/night/sct?size=medium\",\"number\":12,\"temperatureUnit\":\"F\",\"probabilityOfPrecipitation\":{\"unitCode\":\"wmoUnit:percent\",\"value\":null},\"name\":\"Wednesday Night\",\"temperature\":42,\"relativeHumidity\":{\"unitCode\":\"wmoUnit:percent\",\"value\":70},\"startTime\":\"2023-03-08T18:00:00-05:00\",\"isDaytime\":false,\"endTime\":\"2023-03-09T06:00:00-05:00\",\"windDirection\":\"N\",\"windSpeed\":\"6 mph\"},{\"detailedForecast\":\"Mostly sunny, with a high near 59.\",\"dewpoint\":{\"unitCode\":\"wmoUnit:degC\",\"value\":2.2222222222222223},\"temperatureTrend\":null,\"shortForecast\":\"Mostly Sunny\",\"icon\":\"https://api.weather.gov/icons/land/day/sct?size=medium\",\"number\":13,\"temperatureUnit\":\"F\",\"probabilityOfPrecipitation\":{\"unitCode\":\"wmoUnit:percent\",\"value\":null},\"name\":\"Thursday\",\"temperature\":59,\"relativeHumidity\":{\"unitCode\":\"wmoUnit:percent\",\"value\":73},\"startTime\":\"2023-03-09T06:00:00-05:00\",\"isDaytime\":true,\"endTime\":\"2023-03-09T18:00:00-05:00\",\"windDirection\":\"N\",\"windSpeed\":\"7 mph\"},{\"detailedForecast\":\"A slight chance of rain after 1am. Mostly cloudy, with a low around 37.\",\"dewpoint\":{\"unitCode\":\"wmoUnit:degC\",\"value\":3.3333333333333335},\"temperatureTrend\":null,\"shortForecast\":\"Mostly Cloudy then Slight Chance Light Rain\",\"icon\":\"https://api.weather.gov/icons/land/night/bkn/rain?size=medium\",\"number\":14,\"temperatureUnit\":\"F\",\"probabilityOfPrecipitation\":{\"unitCode\":\"wmoUnit:percent\",\"value\":null},\"name\":\"Thursday Night\",\"temperature\":37,\"relativeHumidity\":{\"unitCode\":\"wmoUnit:percent\",\"value\":79},\"startTime\":\"2023-03-09T18:00:00-05:00\",\"isDaytime\":false,\"endTime\":\"2023-03-10T06:00:00-05:00\",\"windDirection\":\"N\",\"windSpeed\":\"7 mph\"}],\"updateTime\":\"2023-03-03T13:18:05+00:00\",\"units\":\"us\",\"updated\":\"2023-03-03T13:18:05+00:00\"}}\n");
    }
    return null;
  }

  /**
   * To check how manytimes normal findWeather is called instead of looking up in cache
   *
   * @return
   */
  @Override
  public int getCallCount() {
    // callCount increment by two each time invoking findWeather
    return callCount;
  }
}
